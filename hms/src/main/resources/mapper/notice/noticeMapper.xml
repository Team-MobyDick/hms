<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mobydick.hms.notice.dao.NoticeDAO">

    <!-- 전체 공지사항 조회 -->
    <select id="selectAllNotices" resultType="com.mobydick.hms.notice.vo.NoticeVO">
        <![CDATA[
        SELECT
            A.NOTICE_ID,
            ROW_NUMBER() OVER(ORDER BY A.CREATED_DATE) AS BNO,
            A.NOTICE_TITLE,
--             A.EMPL_ID,
            B.EMPL_NAME AS EMPL_ID,
            A.NOTICE_CONTENT,
            A.CREATED_DATE,
            A.CREATED_ID,
            A.UPDATED_DATE,
            A.UPDATED_ID
        FROM
            TB_NOTICE A
                LEFT JOIN TB_EMPL B
                          ON A.EMPL_ID = B.EMPL_ID
        ORDER BY CREATED_DATE DESC
        ]]>
    </select>

    <!-- 공지사항 상세 조회 -->
    <select id="selectNoticeById" parameterType="int" resultType="com.mobydick.hms.notice.vo.NoticeVO">
        SELECT
            NOTICE_ID,
            NOTICE_TITLE,
            EMPL_ID,
            NOTICE_CONTENT,
            CREATED_DATE,
            CREATED_ID,
            UPDATED_DATE,
            UPDATED_ID
        FROM
            TB_NOTICE
        WHERE NOTICE_ID = #{noticeId}
    </select>

    <!-- 공지사항 등록 (Oracle 시퀀스 사용 방식) -->
    <insert id="insertNotice" parameterType="com.mobydick.hms.notice.vo.NoticeVO">
        <!-- SEQ_NOTICE_ID 실제 존재하는 시퀀스 이름으로 교체하세요 -->
        <selectKey keyProperty="noticeId" resultType="int" order="BEFORE">
            SELECT SEQ_NOTICE_ID.NEXTVAL FROM DUAL
        </selectKey>

        INSERT INTO TB_NOTICE (
        NOTICE_ID,
        NOTICE_TITLE,
        EMPL_ID,
        NOTICE_CONTENT,
        CREATED_ID,
        UPDATED_ID
        ) VALUES (
        #{noticeId},
        #{noticeTitle},
        #{emplId},
        #{noticeContent},
        #{createdId},
        #{updatedId}
        )
    </insert>

    <!-- 공지사항 수정 -->
    <update id="updateNotice" parameterType="com.mobydick.hms.notice.vo.NoticeVO">
        UPDATE TB_NOTICE
        SET
            NOTICE_TITLE = #{noticeTitle},
            NOTICE_CONTENT = #{noticeContent},
            UPDATED_DATE = SYSDATE,
            UPDATED_ID = #{updatedId}
        WHERE
            NOTICE_ID = #{noticeId}
    </update>

    <!-- 공지사항 삭제 -->
    <delete id="deleteNotice" parameterType="int">
        DELETE FROM TB_NOTICE WHERE NOTICE_ID = #{noticeId}
    </delete>

</mapper>
